# Лабораторная работа 6 — Рефакторинг и code smells

## Проблемы качества, выявленные в исходном коде
- Длинная функция `process_checkout`, объединяющая разбор запроса, валидацию, расчёты и генерацию order_id  
- Дублирование кода и вложенные конструкции  
- Наличие магических чисел (например, налог, скидки, пороги)  
- Сложно читать и поддерживать код, трудно изменять бизнес-логику

---

## Применённые рефакторинги
1. **Разделение кода на отдельные функции по логике**:  
   - `parse_request(request)` — разбор запроса  
   - `validate_request(user_id, items, currency)` — валидация  
   - `validate_items(items)` — проверка товаров  
   - `calculate_subtotal(items)` — подсчёт суммы  
   - `calculate_discount(subtotal, coupon)` — расчёт скидки  
   - `calculate_tax(amount)` — расчёт налога  
   - `generate_order_id(user_id, items)` — генерация order_id

2. **Вынесение магических чисел в константы**:
   ```python
   TAX_RATE = 0.21
   SAVE10_RATE = 0.10
   SAVE20_RATE_HIGH = 0.20
   SAVE20_RATE_LOW = 0.05
   VIP_DISCOUNT_HIGH = 50
   VIP_DISCOUNT_LOW = 10
   VIP_THRESHOLD = 100
   SAVE20_THRESHOLD = 200
### Что стало лучше:
1. **Улучшена читаемость** - функция `process_checkout()` теперь читается как сценарий
2. **Упрощено тестирование** - каждая функция может тестироваться отдельно
3. **Упрощено сопровождение** - изменение логики расчета скидок происходит в одном месте
4. **Улучшена модульность** - функции слабо связаны и могут использоваться повторно
5. **Понятнее структура** - код организован по уровням абстракции

### Основной принцип:
Теперь `process_checkout()` следует схеме:
1. Разбор запроса
2. Валидация данных
3. Расчет промежуточных значений
4. Формирование результата
